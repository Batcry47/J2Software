<div class="container">
  <dialog class="logout-prompt" id="logout" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white'}">
    <div class="popup-header">
      <div class="red-bar"></div>
      <h2 [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : 'black'}">{{'LOGOUT-MESSAGE' | translate}}</h2>
    </div>
    <div class="popup-buttons">
      <button class="popup-button confirm" (click)="this.router.navigate(['/login'])">
        {{'YES' | translate}}
      </button>
      <button class="popup-button cancel" (click)="closePrompt()">{{'NO' | translate}}</button>
    </div>
  </dialog>

  <dialog class="logout-prompt" id="logoutPrompt" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white'}">
    <div class="popup-header">
      <div class="red-bar"></div>
      <h2>{{'INACTIVE-TITLE' | translate}}</h2>
    </div>
    <p>{{'INACTIVE-MESSAGE' | translate}}</p>
    <div class="popup-buttons">
      <button class="popup-button confirm" (click)="resetInactivityTimer(); closeLogoutPrompt()">
        {{'ACTIVE-CONFIRM' | translate}}
      </button>
      <button class="popup-button cancel" (click)="this.router.navigate(['/login'])">
        {{'INACTIVE-LOGOUT' | translate}}
      </button>
    </div>
  </dialog>

  <div class="sidebar" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white' }">
    <h1>J2 Software</h1>
    <ul [ngStyle]="{'color' : isDarkThemeToggled() ? 'gray' : 'white' }">
      <li><a routerLink="/home">{{'SIDEBAR.Home' | translate}}</a></li>
      <li><a routerLink="/dashboard" class="active">{{'SIDEBAR.Dashboard' | translate}}</a></li>
      <li><a routerLink="/report">{{'SIDEBAR.Report' | translate}}</a></li>
      <li><a (click)="openPrompt()">{{'SIDEBAR.Logout' | translate}}</a></li>
      <li><a (click)="toggleDarkTheme()">{{'SIDEBAR.Theme' | translate}}</a></li>
      <li>
        <div class="sort-options">
          <span class="sort-label">Select Language:</span>
          <select class="sort-select" [(ngModel)] = "selectedLanguage" (change)="changeLanguage(selectedLanguage)">
            <option value="en">English</option>
            <option value="afr">Afrikaans</option>
          </select>
        </div>
      </li>
    </ul>
  </div>

  <div class="dashboard-container" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'background-image': isDarkThemeToggled() ? 'url(assets/images/background_image_dark.jpg)' : 'url(assets/images/background_image.png)'}">
    <h1 class="dashboard-title" [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">{{'SIDEBAR.Dashboard' | translate}}</h1>
    <div class="chart-card" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white'}">
      <h2 class="chart-title" [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">{{ "GRAPH-TITLE" | translate}}</h2>
      <div class="chart-content">
        <canvas id="severityChart" ></canvas>
      </div>
    </div>

    <div class="dashboard-content">
      
      <div class="result-header">
        <div class="result-count">{{ filteredResults.length }} {{'RESULT-TITLE' | translate}}</div>
        <button class="toggle-view-btn" (click)="toggleView()">
          {{ showArchive ? ('CURRENT_MESSAGE' | translate) : ('ARCHIVED_MESSAGE' | translate) }}
        </button>
        <div class="search-bar">
          <input type="text" [placeholder]="'SEARCH-PLACEHOLDER' | translate" [(ngModel)]="searchQuery"
            (input)="onSearchInput()" class="search-input" />
        </div>
        <div class="sort-options">
          <span class="sort-label">{{'SORT-LABEL' | translate}}</span>
          <select class="sort-select" [(ngModel)]="selectedSortOption" (change)="onSortChange()">
            <option value="category">Category</option>
            <option value="method">Method</option>
            <option value="username">Username</option>
            <option value="ipAddress">IP Address</option>
            <option value="timestamp">Timestamp</option>
          </select>
        </div>
      </div>

      <div class="archive-actions" *ngIf="selectedRows.length > 0">
        <button *ngIf="!showArchive" class="archive-btn" (click)="archiveSelectedRows()">
          Archive Selected ({{ selectedRows.length }})
        </button>
        <button *ngIf="showArchive" class="unarchive-btn" (click)="unarchiveSelectedRows()">
          Unarchive Selected ({{ selectedRows.length }})
        </button>
      </div>

      <div class="results-table" >
        <table>
          <thead>
            <tr>
              <th>{{'COLUMNS.Category' | translate}}</th>
              <th>{{'COLUMNS.Method' | translate}}</th>
              <th>{{'COLUMNS.Username' | translate}}</th>
              <th>{{'COLUMNS.IP Address' | translate}}</th>
              <th>{{'COLUMNS.Timestamp' | translate}}</th>
            </tr>
          </thead>
          <tbody class="table-content">
            <tr *ngFor="let result of filteredResults" [ngClass]="result.Severity.toLowerCase()"
              (mouseenter)="showCheckbox(result)" (mouseleave)="hideCheckbox(result)">
              <td>
                <div class="checkbox-wrapper" [class.visible]="isRowSelected(result) || isRowHovered(result)">
                  <input type="checkbox" [checked]="isRowSelected(result)" (change)="toggleRowSelection(result)" />
                </div>
                {{  'Category.' + result.Category | translate }}
              </td>
              <td>{{ 'Method.' + result.Method | translate  }}</td>
              <td>{{ result.Username }}</td>
              <td>{{ result.IPAddress }}</td>
              <td>{{ result.EventTimeStamp.replace('T', ' ') }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="filter-panel" [class.collapsed]="isFilterCollapsed" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white'}">
    <button class="filter-toggle" (click)="toggleFilter()">
      <i class="fas" [ngClass]="isFilterCollapsed ? 'fa-chevron-left' : 'fa-chevron-right'"></i>
      {{ isFilterCollapsed ? '<<' : '>>' }}
    </button>
    <div class="filter-content" [class.hidden]="isFilterCollapsed" [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : 'black'}">
      <h3>{{ 'FILTER-TITLE' | translate}}</h3>
      <div class="filter-section">
        <h4>{{ 'SEVERITY-TITLE' | translate}} <a href="#" class="clear-filter"
            (click)="clearSeverityFilters(); $event.preventDefault()">{{ 'CLEAR' | translate}}</a></h4>
        <div class="filter-options">
          <label class="checkbox-label" *ngFor="let severity of ['Informational', 'Low', 'Medium', 'High', 'Critical']">
            <input type="checkbox" class="filter-checkbox" [attr.data-severity]="severity.toLowerCase()"
              (change)="onFilterChange()">
            <span class="checkbox-custom"></span>
            <span class="checkbox-label-text">{{ 'SEVERITY-LEVEL.' + severity | translate}}</span>
          </label>
        </div>
      </div>
      <div class="filter-section">
        <h4>{{ 'CATEGORY-TITLE' | translate}}<a href="#" class="clear-filter"
            (click)="clearCategoryFilters(); $event.preventDefault()">{{ 'CLEAR' | translate}}</a></h4>
        <div class="filter-options">
          <label class="checkbox-label"
            *ngFor="let category of ['Collection', 'Defence Evasion', 'Privilege Escalation', 'Exfiltration', 'Impact', 'Initial Access', 'Persistence', 'Reconnaissance', 'Execution', 'Resource Development']">
            <input type="checkbox" class="filter-checkbox"
              [attr.data-category]="category.toLowerCase().replace(' ', '-').replace(' ', '-')"
              (change)="onFilterChange()" [checked]="selectedCategory === category">
            <span class="checkbox-custom"></span>
            <span class="checkbox-label-text">{{ 'FILTER-CATEGORIES.' + category | translate }}</span>
          </label>
        </div>
      </div>
    </div>
  </div>
</div>