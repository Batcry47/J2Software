<div class="container">
  <dialog class="logout-prompt" id="logout" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white'}">
    <div class="popup-header">
      <div class="red-bar"></div>
      <h2 [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">Are you sure you would like to log out?</h2>
    </div>
    <div class="popup-buttons">
      <button class="popup-button confirm" (click)="this.route.navigate(['/login'])">Yes</button>
      <button class="popup-button cancel" (click)="closePrompt()">No</button>
    </div>
  </dialog>

  <dialog class="logout-prompt" id="logoutPrompt" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white'}">
    <div class="popup-header">
      <div class="red-bar"></div>
      <h2>Are you still there?</h2>
    </div>
    <p [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">You've been inactive for a while. Would you like to continue?</p>
    <div class="popup-buttons">
      <button class="popup-button confirm" (click)="resetInactivityTimer(); closeLogoutPrompt()">Yes, I'm here</button>
      <button class="popup-button cancel" (click)="this.route.navigate(['/login'])">Logout</button>
    </div>
  </dialog>

  <div class="sidebar" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white'}">
    <h1>J2 Software</h1>
    <ul>
      <li><a routerLink="/home">Home</a></li>
      <li><a routerLink="/dashboard">Dashboard</a></li>
      <li><a routerLink="/report" class="active">Report</a></li>
      <li><a (click)="openPrompt()">Logout</a></li>
      <li><a (click)="toggleDarkTheme()">Change Theme</a></li>
    </ul>
  </div>

  <div class="report-container" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'background-image': isDarkThemeToggled() ? 'url(assets/images/background_image_dark.jpg)' : 'url(assets/images/background_image.png)'}">
    <div class="date-selection" [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
      <h2 [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">Select Date</h2>
      <div class="date-inputs">
        <div class="date-input">
          <label for="start_date" [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">Start Date:</label>
          <input type="date" class="date-selector" id="start_date" name="start_date" min="2024-01-01"
            (change)="minEndDate(startDateInput, endDateInput)" #startDateInput>
        </div>
        <div class="date-input">
          <label for="end_date" [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">End Date:</label>
          <input type="date" class="date-selector" id="end_date" name="end_date" min="2024-01-01"
            (change)="updateAlertCount()" #endDateInput>
        </div>
      </div>
    </div>

    <header class="report-header" [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">
      <h1 [ngStyle]="{'color' : isDarkThemeToggled() ? 'white' : ''}">Alert Report</h1>
      <h2 *ngIf="startDateInput.value != '' && endDateInput.value != ''">
        {{ startDateInput.value }} - {{ endDateInput.value }}
      </h2>
    </header>

    <div class="report-table" >
      <table>
        <tbody>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : 'black'}">
            <td>Malicious Alerts</td>
            <td>{{impactAlerts + initialAccessAlerts + defenceEvasionAlerts + exfiltrationAlerts 
              + collectionAlerts + privilegeEscalationAlerts + persistenceAlerts + reconnaissanceAlerts + 
              executionAlerts + resourceDevelopmentAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Impact</td>
            <td>{{impactAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Initial Access</td>
            <td>{{initialAccessAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Defence Evasion</td>
            <td>{{defenceEvasionAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Exfiltration</td>
            <td>{{exfiltrationAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Collection</td>
            <td>{{collectionAlerts}}</td>
          </tr >
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Privilege Escalation</td>
            <td>{{privilegeEscalationAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Persistence</td>
            <td>{{persistenceAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Execution</td>
            <td>{{executionAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Resource Development</td>
            <td>{{resourceDevelopmentAlerts}}</td>
          </tr>
          <tr [ngStyle]="{'background-color' : isDarkThemeToggled() ? 'black' : 'white', 'color' : isDarkThemeToggled() ? 'white' : ''}">
            <td>Reconnaissance</td>
            <td>{{reconnaissanceAlerts}}</td>
          </tr>
          <tr class="total-row">
            <td>Total Alerts</td>
            <td>{{impactAlerts + initialAccessAlerts + defenceEvasionAlerts + exfiltrationAlerts 
            + collectionAlerts + privilegeEscalationAlerts + persistenceAlerts + reconnaissanceAlerts + 
            executionAlerts + resourceDevelopmentAlerts}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="downloaded-report-results">
      <h2 *ngIf="startDateInput.value != '' && endDateInput.value != ''">Alert Report for {{startDateInput.value}} - {{endDateInput.value}}</h2><br>
      <h2 *ngIf="startDateInput.value == '' && endDateInput.value == ''">All Time Alert Report</h2>
      <label>Malicious Alerts: {{impactAlerts + initialAccessAlerts + defenceEvasionAlerts + exfiltrationAlerts 
        + collectionAlerts + privilegeEscalationAlerts + persistenceAlerts + reconnaissanceAlerts + 
        executionAlerts + resourceDevelopmentAlerts}}</label><br>
      <label>Impact: {{impactAlerts}}</label><br>
      <label>Initial Access: {{initialAccessAlerts}}</label><br>
      <label>Defence Evasion: {{defenceEvasionAlerts}}</label><br>
      <label>Exfiltration: {{exfiltrationAlerts}}</label><br>
      <label>Collection: {{collectionAlerts}}</label><br>
      <label>Privilege Escalation: {{privilegeEscalationAlerts}}</label><br>
      <label>Persistence: {{persistenceAlerts}}</label><br>
      <label>Reconnaissance: {{reconnaissanceAlerts}}</label><br>
      <label>Execution: {{executionAlerts}}</label><br>
      <label>Resource Development: {{resourceDevelopmentAlerts}}</label><br>
    </div>

    <div class="download-container">
      <button class="download-btn" (click)="downloadReport()">Download Report</button>
    </div>
  </div>
</div>