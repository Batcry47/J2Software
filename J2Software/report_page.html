<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Report | J2 Software</title>
</head>

<body class="report-page">
  <header>
    <nav>
      <div class="top-left-nav">
        <ul>
          <li> <img src="_images/logo_10_2019.png" id="NavLogo"></li>
          <li><a href="index.html">Home</a></li>
          <li><a href="dashboard.html">Dashboard</a></li>
          <li><a class="current">Report</a></li>
        </ul>
      </div>
      <div class="top-right-nav">
        <ul>
          <li><a href="login.html">Logout</a></li>
        </ul>
      </div>
    </nav>
  </header>
  <div class="date-selector">
    <h2>Select Date Range</h2>
    <label for="start_date">Start Date:</label>
    <input type="date" class="date-selector" id="start_date" name="start_date" min="2024-01-01">

    <label for="end_date">End Date:</label>
    <input type="date" class="date-selector" id="end_date" name="end_date" min="2024-01-01"
      onchange="updateEndDateMin()">>
  </div>
  <script>
    function updateEndDateMin() {
      const startDate = document.getElementById('start_date').value;
      const endDate = document.getElementById('end_date').value;
      if (startDate && endDate) {
        const reportDate = document.querySelector('.report-container h1');
        reportDate.textContent = `Alert Report for ${startDate} - ${endDate}`;
      }
      if (startDate) {
        endDate.min = startDate;
        if (endDate.value < startDate) {
          endDate.value = startDate;
        }

        const maliciousAlerts = Math.floor(Math.random() * 100);
        const impact = Math.floor(Math.random() * 100);
        const initialAccess = Math.floor(Math.random() * 100);
        const defenceEvasion = Math.floor(Math.random() * 100);
        const exfiltration = Math.floor(Math.random() * 100);
        const collection = Math.floor(Math.random() * 100);
        const escalation = Math.floor(Math.random() * 100);
        const persistence = Math.floor(Math.random() * 100);

        const reportContainer = document.querySelector('.report-container ul');

        reportContainer.innerHTML = `
            <li>Malicious Alerts: ${maliciousAlerts}</li><br>
            <li>Impact: ${impact}</li><br>
            <li>Initial Access: ${initialAccess}</li><br>
            <li>Defence Evasion: ${defenceEvasion}</li><br>
            <li>Exfiltration: ${exfiltration}</li><br>
            <li>Collection: ${collection}</li><br>
            <li>Escalation: ${escalation}</li><br>
            <li>Persistence: ${persistence}</li><br>
            <li>
                <h3>Total Alerts: ${maliciousAlerts + impact + initialAccess + defenceEvasion + exfiltration + collection + escalation + persistence}</h3>
            </li>
        `;
      }
    }
  </script>

  <br /><br /><br />
  <div class="report-container">
    <h1>Alert Report for 01-01-2024 - 31-01-2024</h1>
    <ul>
      <li>Malicious Alerts: 0</li><br>
      <li>Impact: 0</li><br>
      <li>Initial Access: 0</li><br>
      <li>Defence Evasion: 0</li><br>
      <li>Exfiltration: 0</li><br>
      <li>Collection: 0</li><br>
      <li>Escalation: 0</li><br>
      <li>Persistence: 1412</li><br>
      <li>
        <h3>Total Alerts: 1412</h3>
      </li>
    </ul>
    <br />
  </div>
  <br />
  <div class="button-container">
    <div class="dropdown">
      <button id="downloadReportButton" class="report-button">Download Report</button>
      <div class="dropdown-content">
        <a href="#" id="downloadTxt">TXT</a>
        <a href="#" id="downloadCsv">CSV</a>
      </div>
    </div>
    <button id="downloadChartButton" class="report-button">Download Graph</button>
  </div>
  <div class="line-graph">
    <canvas id="lineChart"></canvas>
  </div>

  <script>
    const lineChartCanvas = document.getElementById('lineChart');

    const lineChartData = {
      labels: ['Jan 1', 'Jan 8', 'Jan 15', 'Jan 22', 'Jan 29'],
      datasets: [
        {
          label: 'Alerts',
          data: [100, 200, 150, 300, 250],
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
          borderWidth: 1
        }
      ]
    };

    const lineChartConfig = {
      type: 'line',
      data: lineChartData,
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    };

    const lineChart = new Chart(lineChartCanvas, lineChartConfig);

    function generateCsvContent() {
      const maliciousAlerts = parseInt(document.querySelector('.report-container ul li:nth-of-type(1)').innerText.split(': ')[1]);
      const impact = parseInt(document.querySelector('.report-container ul li:nth-of-type(2)').innerText.split(': ')[1]);
      const initialAccess = parseInt(document.querySelector('.report-container ul li:nth-of-type(3)').innerText.split(': ')[1]);
      const defenceEvasion = parseInt(document.querySelector('.report-container ul li:nth-of-type(4)').innerText.split(': ')[1]);
      const exfiltration = parseInt(document.querySelector('.report-container ul li:nth-of-type(5)').innerText.split(': ')[1]);
      const collection = parseInt(document.querySelector('.report-container ul li:nth-of-type(6)').innerText.split(': ')[1]);
      const escalation = parseInt(document.querySelector('.report-container ul li:nth-of-type(7)').innerText.split(': ')[1]);
      const persistence = parseInt(document.querySelector('.report-container ul li:nth-of-type(8)').innerText.split(': ')[1]);

      const totalAlerts = maliciousAlerts + impact + initialAccess + defenceEvasion + exfiltration + collection + escalation + persistence;

      const csvContent = `Malicious Alerts,Impact,Initial Access,Defence Evasion,Exfiltration,Collection,Escalation,Persistence,Total Alerts\n${maliciousAlerts},${impact},${initialAccess},${defenceEvasion},${exfiltration},${collection},${escalation},${persistence},${totalAlerts}`;

      return csvContent;
    }

    function downloadReport(format) {
      let reportContent;
      let blob;
      let filename;

      if (format === 'txt') {
        reportContent = document.querySelector('.report-container').innerText;
        blob = new Blob([reportContent], { type: 'text/plain' });
        filename = 'Alert_Report.txt';
      } else if (format === 'csv') {
        const csvContent = generateCsvContent();
        blob = new Blob([csvContent], { type: 'text/csv' });
        filename = 'Alert_Report.csv';
      }

      const a = document.createElement('a');
      a.href = window.URL.createObjectURL(blob);
      a.download = filename;

      document.body.appendChild(a);

      a.click();

      document.body.removeChild(a);
    }

    function downloadChart() {
      const chartCanvas = document.getElementById('lineChart');
      const chartDataUrl = chartCanvas.toDataURL('image/jpeg');

      const a = document.createElement('a');
      a.href = chartDataUrl;
      a.download = 'chart.jpg';

      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    document.getElementById('downloadChartButton').addEventListener('click', function () {
      downloadChart();
    });

    document.getElementById('downloadReportButton').addEventListener('click', function () {
      const dropdownContent = document.querySelector('.dropdown-content');
      dropdownContent.classList.toggle('show');
    });

    document.getElementById('downloadTxt').addEventListener('click', function () {
      downloadReport('txt');
    });

    document.getElementById('downloadCsv').addEventListener('click', function () {
      downloadReport('csv');
    });
  </script>
</body>

</html>